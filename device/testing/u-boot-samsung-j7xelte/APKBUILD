# Reference: <https://postmarketos.org/devicepkg>
# Contributor: Paul Cercueil <paul@crapouillou.net>
pkgname=u-boot-samsung-j7xelte
pkgver=2024.01
pkgrel=0
pkgdesc="U-Boot for Samsung Galaxy SII"
arch="aarch64"
_carch="arm"
license="GPL-2.0-only"
url="https://source.denx.de/u-boot"
options="!check"
makedepends="
	$depends_dev
	arm-trusted-firmware
	autoconf
	bc
	bison
	dtc
	flex
	mkbootimg
	openssl-dev
	u-boot-tools
"

options="!check"
_commit="43f2873fa98b1da6eb56d756315c7bd7db63db27"
source="
	https://source.denx.de/u-boot/u-boot/-/archive/v$pkgver-rc6/u-boot-v$pkgver-rc6.tar.gz
	gcc-12-u-boot-2020-fix-read-only-segment-has-dynamic-relocations-error.patch
	0001-arm-add-samsung-j7xelte-development-code.patch
	0002-arm-add-samsung-j7xelte-development-code.patch
	0003-arm-add-samsung-j7xelte-development-code.patch
	0004-arm-samsung-j7xelte-general-fixes.patch
"

builddir="$srcdir/u-boot-v$pkgver-rc6"

prepare() {
	default_prepare
}

build() {
	unset LDFLAGS
	LC_ALL=C date +'#define U_BOOT_DATE "%b %d %C%y"' > include/timestamp_autogenerated.h
	LC_ALL=C date +'#define U_BOOT_TIME "%T"' >> include/timestamp_autogenerated.h

	make ARCH="$_carch" j7xelte_config
	make ARCH="$_carch" CC="${CC:-gcc}" all
}

package() {
	unset LDFLAGS
	install -Dm644 "$builddir/u-boot.bin" \
		"$pkgdir/usr/share/u-boot/j7xelte/"
}

sha512sums="
0243864749168e868c4e6953c835985248ac0afbe8b62e22606c71546c3a9c85fc00a0a4d6ce5efb8bfe63196377c189f9893a3e673a19db9229bdbdfc16c8c9  u-boot-v2024.01-rc6.tar.gz
e8d27471665a89a882d8add3c4446bec3e0fd84fb830381e00c71e159d528c129ae9f14469ac52ef3b2f40d144c10241ebb8004276a962b87c22751cb28ab96c  gcc-12-u-boot-2020-fix-read-only-segment-has-dynamic-relocations-error.patch
ae7e36b93448989a457467bda3a9c323e759f97b119e3b44cdaa0b3dac4deed1b9f9da9169533a03845ac224cbc8fa1efabb6a6c9f9dffbd33cb4174bcd416ee  0001-arm-add-samsung-j7xelte-development-code.patch
00845c0b08edc1b4a7c2cf31d1a672365a43f9488099067ffc5b1a703b846060506c81b3f68d41f38b7caa976d9505d20c065d02850bb383e2108378bc0fec65  0002-arm-add-samsung-j7xelte-development-code.patch
ce07d697a304bd36f67ef7898bc10aaca19cfd41883e6834b438b882721d339f1c28bb5b932d8f96a0bb72c7d9f57a2557c602b5865e8e677ffa1c7f20910647  0003-arm-add-samsung-j7xelte-development-code.patch
5bb4196f41ab9126ec038e8d19ca1f547f800a8426f00a3db4371a85b08633f1de3396a0b045c5d5d7f6725492c129f0049f3156cc4322a4765e264c63da4c3d  0004-arm-samsung-j7xelte-general-fixes.patch
98c51cc66269d19517c7eff91dce3088bfd1731d7d6bb766c08ddf6f962012712e10fafaa54af4ae5db0608c89f8cc116684a0ba1887dd5a75c645723552b6ee  boot.scr
976c36b469a5c36e1823c35e4e1bc41d88f12c6710d1d4f8f904349ab06ee58a6c728dc4b705b7578427e322c57ecd4e4c61fc62effc88e25987f6ea3e6ffcc2  uboot-script.cmd
"
