# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Luca Weiss <luca@z3ntu.xyz>
pkgname=platform-api
pkgver=0_git20200720
pkgrel=0
_commit="dec173823d718ec8ffe9e8d21714819ea928c3e2"
pkgdesc="Platform API for system level capabilities"
arch="all"
url='https://github.com/ubports/platform-api'
license="GPL-3.0-only AND LGPL-3.0-only"
depends_dev="process-cpp-dev url-dispatcher-dev location-service-dev"
makedepends="$depends_dev cmake cmake-extras dbus-cpp-dev gtest-dev gmock"
source="$pkgname-$_commit.tar.gz::https://github.com/ubports/$pkgname/archive/$_commit.tar.gz
	0002-Only-use-Hybris-when-available.patch"
subpackages="$pkgname-dev"
builddir="$srcdir/$pkgname-$_commit"

build() {
	cmake -B build \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr
	make -C build
}

check() {
	cd build
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	make -C build DESTDIR="$pkgdir" install
}

sha512sums="514287324d90acda84537a277f8e5b4158d3cf034fe18edefe1e1838dcbaab350bde09467e717e8a607f3655f1dc4ca021047e6f1202d5e776feeaf472cf1b6f  platform-api-dec173823d718ec8ffe9e8d21714819ea928c3e2.tar.gz
1dceef13de9321c1aaa2f8530ff90c8cdf4359788453575b8e81eca12246f015ca03cc8e0721936b0762e6f087f55bb274049d4213e64b607c9977a69fac3042  0002-Only-use-Hybris-when-available.patch"
