# Maintainer: Luca Weiss <luca@z3ntu.xyz>
pkgname=lomiri-deviceinfo
pkgver=0_git20210317
_commit="3bdd6b1c92fec7eefe39f11b43e0d9ea8adf1b9d"
pkgrel=0
pkgdesc="Library to detect and configure devices"
arch="all"
url="https://gitlab.com/ubports/core/deviceinfo"
license="GPL-3.0-only"
makedepends="cmake cmake-extras gtest-dev yaml-cpp-dev"
source="https://gitlab.com/ubports/core/deviceinfo/-/archive/$_commit/deviceinfo-$_commit.tar.gz
	0001-Allow-changing-of-CONFIG_PATH-during-compile-time.patch"
subpackages="$pkgname-dev"
builddir="$srcdir/deviceinfo-$_commit"

build() {
	cmake -B build \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCONFIG_PATH=/etc/lomiri-deviceinfo
	cmake --build build
}

check() {
	cd build
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	DESTDIR="$pkgdir" cmake --build build --target install
}

sha512sums="29552ce0f63fd24e17d30339722a50630c2b617b331e78ab470c89482c3077bfdcffde7efefa1f52440998194854e1e3bddcd3739cd15dbbe493fd2fe29131dd  deviceinfo-3bdd6b1c92fec7eefe39f11b43e0d9ea8adf1b9d.tar.gz
6c1b7f1c03a0d522aaa86bf22753a897316d488ea5226df6f87f9c53b5345e2f3f61b97b4d4754aa5c1ea9b05e411bbf65bdd72dfcd9e90b179c1941abd1a8ac  0001-Allow-changing-of-CONFIG_PATH-during-compile-time.patch"
