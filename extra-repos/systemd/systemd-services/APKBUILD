# Maintainer: Caleb Connolly <caleb@connolly.tech>
# Service files for projects that would otherwise either
# need to be forked just for the service, or don't provide
# a service file at all.

# How to add a new service file (4 steps):
pkgname=systemd-services
# 1. bump pkgver
pkgver=13
pkgrel=1
pkgdesc="Systemd service files"
url="https://postmarketos.org"
arch="noarch"
options="!check"
license="BSD-3-Clause"
triggers="$pkgname.trigger=/usr/lib/systemd"

# 2. Add a new entry to subpackes in the format
#    <pkgname>-systemd:_service where pkgname is the name
#    of the package this service file should be part of
#    ALPHABETICAL ORDER!!!
subpackages="
	apk-polkit-rs-systemd:_service
	at-spi2-core-systemd:_service
	bluez-systemd:_service
	dconf-systemd:_service
	flatpak-systemd:_service
	geoclue-systemd:_service
	gnome-clocks-systemd:_service
	hexagonrpcd-systemd:_service
	iio-sensor-proxy-systemd:_service
	iwd-systemd:_service
	mmsd-tng-systemd:_service
	modemmanager-systemd:_service
	nftables-systemd:_service
	openssh-server-pam-systemd:_service
	pd-mapper-systemd:_service
	phosh-systemd:_service
	q6voiced-systemd:_service
	qbootctl-systemd:_service
	rmtfs-systemd:_service
	rtkit-systemd:_service
	sleep-inhibitor-systemd:_service
	tqftpserv-systemd:_service
	wireplumber-systemd:_service
	wpa_supplicant-systemd:_service
	xdg-desktop-portal-systemd:_service
	xdg-desktop-portal-gtk-systemd:_service
	xdg-desktop-portal-gnome-systemd:_service
	xdg-desktop-portal-wlr-systemd:_service
"
# 3. Add a new entry below with the list of service files
#    to install for that package
_apk_polkit_rs_sources="system/apk-polkit-server.service"
_at_spi2_core_sources="user/at-spi-dbus-bus.service"
_bluez_sources="
	system/bluetooth.service
	system/bluetooth-mesh.service
	user/dbus-org.bluez.obex.service
	user/mpris-proxy.service
	user/obex.service
" # From bluez build with --enable-systemd
_dconf_sources="user/dconf.service"
_flatpak_sources="system/flatpak-system-helper.service user/flatpak-session-helper.service user/flatpak-portal.service"
_geoclue_sources="system/geoclue.service" # From https://gitlab.freedesktop.org/geoclue/geoclue/-/blob/master/data/geoclue.service.in
_gnome_clocks_sources="user/gnome-clocks.service"
_hexagonrpcd_sources="system/hexagonrpcd-sdsp.service system/iio-sensor-proxy.d/hexagonrpcd.conf"
_iio_sensor_proxy_sources="system/iio-sensor-proxy.service"
_iwd_sources="system/iwd.service" # From https://git.kernel.org/pub/scm/network/wireless/iwd.git/tree/src/iwd.service.in
_mmsd_tng_sources="user/mmsd-tng.service"
_modemmanager_sources="system/ModemManager.service"
_nftables_sources="system/nftables.service"
_openssh_server_pam_sources="system/sshd.service system/sshdgenkeys.service"
_pd_mapper_sources="system/pd-mapper.service"
_phosh_sources="system/phosh.service"
_q6voiced_sources="system/q6voiced.service"
_qbootctl_sources="system/qbootctl.service"
_rmtfs_sources="system/rmtfs.service"
_rtkit_sources="system/rtkit-daemon.service"
_sleep_inhibitor_sources="system/sleep-inhibitor.service"
_tqftpserv_sources="system/tqftpserv.service"
_wireplumber_sources="user/wireplumber.service"  # https://gitlab.freedesktop.org/pipewire/wireplumber/-/blob/master/src/systemd/user
_wpa_supplicant_sources="system/wpa_supplicant.service"
_xdg_desktop_portal_sources="
	user/xdg-desktop-portal.service
	user/xdg-desktop-portal-rewrite-launchers.service
	user/xdg-document-portal.service
	user/xdg-permission-store.service
"
_xdg_desktop_portal_gtk_sources="user/xdg-desktop-portal-gtk.service"
_xdg_desktop_portal_gnome_sources="user/xdg-desktop-portal-gnome.service"
_xdg_desktop_portal_wlr_sources="user/xdg-desktop-portal-wlr.service"

flatpath() {
	local i
	for i in $@; do
		echo "$i" | sed s./.-.g
	done
}

# 4. Add the _sources variable to the list below
source="$(flatpath \
	$_apk_polkit_rs_sources \
	$_at_spi2_core_sources \
	$_bluez_sources \
	$_dconf_sources \
	$_flatpak_sources \
	$_geoclue_sources \
	$_gnome_clocks_sources \
	$_hexagonrpcd_sources \
	$_iio_sensor_proxy_sources \
	$_iwd_sources \
	$_mmsd_tng_sources \
	$_modemmanager_sources \
	$_nftables_sources \
	$_openssh_server_pam_sources \
	$_pd_mapper_sources \
	$_phosh_sources \
	$_q6voiced_sources \
	$_qbootctl_sources \
	$_rmtfs_sources \
	$_rtkit_sources \
	$_sleep_inhibitor_sources \
	$_tqftpserv_sources \
	$_wireplumber_sources \
	$_wpa_supplicant_sources \
	$_xdg_desktop_portal_sources \
	$_xdg_desktop_portal_gtk_sources \
	$_xdg_desktop_portal_gnome_sources \
	$_xdg_desktop_portal_wlr_sources \
)"

_service() {
	local name=$(echo ${subpkgname%%-systemd})
	local n=$(echo ${subpkgname%-systemd} | sed s/-/_/g)
	pkgdesc="$name systemd service files"
	install_if="systemd-services=$pkgver-r$pkgrel systemd $name"
	for f in $(eval "echo \$_${n}_sources"); do
		install -Dm644 "$srcdir/$(flatpath "$f")" "$subpkgdir"/usr/lib/systemd/"$f"
	done
}

package() {
	mkdir -p "$pkgdir"
}

sha512sums="
269dfc4748a9f1c4f49be8bab399d7412b6ff3b6d6ed9b3f2e31074b791789fb39aad450b4d43d318e7a070d1118ba79f216782b064cd106feac3eb4a8ca5581  system-apk-polkit-server.service
12f5e008b0a41b3426b29f33556689ef88ba7184293ddb78fdaaf05cc4d029fd0b4c8fbef668aefed103a9f48c525f04a8e4e60ddc6e4329698aaf761b8e8f81  user-at-spi-dbus-bus.service
de133c35cf95d7c833368c9010264668e72657400ad4e5259ef046321c878507f36ef73fa7b4759f69c9d18cda8f8db8d7675d794d9a28f46480fb4d47ba9e0c  system-bluetooth.service
7972e37d950d8e337f109242dc3a7689d0d6e43b80ce42decd81f8d48abaf275a50f5d980d5a40d4494608a2f88f745e1d4639688e179c95792bfb6f398b9ae4  system-bluetooth-mesh.service
5ad5f8adcc89759e5c935a2e55803fac52a9681af3a28f5c8d46f693717afcf7c8c6394f85dd5dbc1ddb575b909b0f6feee2e9973ee177e6445d375136b932ee  user-dbus-org.bluez.obex.service
00049b418fab6dec7d9931a87cc64d2062efa0f7128bec1a693bfdf112703e628a2f1c98d2d5bf71554e6e576882890cef7a02de283909b1dd2f4c5ec0f6393e  user-mpris-proxy.service
5ad5f8adcc89759e5c935a2e55803fac52a9681af3a28f5c8d46f693717afcf7c8c6394f85dd5dbc1ddb575b909b0f6feee2e9973ee177e6445d375136b932ee  user-obex.service
e4de73d12abd046c8683e3be6e3aab40a5db3f5d6246cedbb3ff099bcc8037a167b23ac957d30f1118db571b69cb10c042272ac2b54dacf83fa6a3e9dad13a87  user-dconf.service
0cfef56afeea103ca487b36f13665021bb349b8c890f023135a93c47d45cb58dd39ffe76212fb780546b1aaed8174e40345a961d7125f7d7ace5921e1dcc7ba9  system-flatpak-system-helper.service
815a3072c211c85ff475ac7f2fb9c280b567b98777c0f7bf7fea4575b5eaa3b9a4003a08eb3b8cb5b2d7f9fb6525e04491e8d87013e2539ae3a574db647f97b1  user-flatpak-session-helper.service
7a17986c0f0554f0b27a5933b3e04657323edb23047878616727863fdc748cb8d8fea978f43895341037e2d1512bbd492bdbc19c40419cd3e109345614645388  user-flatpak-portal.service
f3463b85ac47055b400dfd2e24694c5e1dc6ab039efac0fe54496fc027c0732cda5e52a362a497b372dea671dc615154e8abfea866728d243cbbcd25e68a91aa  system-geoclue.service
bc7987a001d2076788d904f1ea6d3e97a2ab905ee55302ffb90402133c2b9fb760d7ad94e06971d811b9d905048e164cb78355f8cd087219b5b8ff6dab2fbd9c  user-gnome-clocks.service
b009a1494f84705dcbea664823e24fb18f326ca84017d9c470ef55c0225d519993aacacf76b24c895ee926dbc2b3269ebc6b2a353cda5ad1b732af5624941a6a  system-hexagonrpcd-sdsp.service
af0e416f78ab317fe09813de58b446e5178457992ea4a2da2eb128811045201087d847e1b7ac0447a59c20129a736135e5d76b113262aa1f76b994e77b9c6b42  system-iio-sensor-proxy.d-hexagonrpcd.conf
d12ebe6e7db2a8e34baab640dd4e2ea9cd01bc19054adf32d55528a6b27f71c2006ac2d65a58c98e21ed598e9cc66bfe79e197d20ed9d13f866a5a6cd3e247d5  system-iio-sensor-proxy.service
df3388cb7b9d035e54b34d8f8a6594be89c3015f979fe3bdc199fb7db1ab0bef821d6b306eecdf978eb227454d5e50aab29ac02d9722b1b075ec0ce4705e3518  system-iwd.service
873b53592786a978659bda8d32de5ed9a9f163ca298c4f4112f10bf635a8170c4060cc15b57ff72b3afd50075cd1c5dbc10030f00b166e2540397da9e1c5e46b  user-mmsd-tng.service
5eab6a59c81232b188df45482e325b2d1cb9e038ca147a1b6983c1c095d8194fba804793c5e291b201a820976c8f506aadd2daf7c52fe573a3af708fc9984641  system-ModemManager.service
d41d0aa1d4d577cd718185399c95055c0511d4aeb902c771ccec13655354aafc85c3f270431fd3debc7e05f0a8cbdb90f1969b673ae7e5310c1f46cb8120e3f2  system-nftables.service
fa445c4a53214524baed4e9c52a5463592a074f88a5a286eacb60d0907c0545f725afde23abd68cf611067add80c2ccb289a381fc5ff6a5f654ea49c81f02fe8  system-sshd.service
c0badea3905c1d53d213fbfe11d25b556a2e484fe77eb50e9f4d42e25b67b56a0804e7d8e1b7731cd280cbb3525b4c60311817609381e2308d9f2dfb7c0d7072  system-sshdgenkeys.service
0bed9a8a719661609ad84d1c6fcdf2fe9213e741682b7ddebad82d9744f137c593788ed522868f10b95b599d81743d07ec3212630a7e99d333261dfa1bf1cc11  system-pd-mapper.service
5f53e07a48c64ab27deead4c1dc64dbea048de5632026d131e27e0fc3115723a1138d043199e2fdba9a281c420b3286a0aa96b063ed7f02c1153487ef732dd98  system-phosh.service
4c4c3f1e5e829ff67dd35df59120ab59730ff1f1ca0aab93f16d670132979a99099fad59e6c736908cc19df9172c9bdfe476ec721a1cc28de8c2210da46ce1f1  system-q6voiced.service
621189aa251655796795f4fa0cd79360bb67573e7327e545064eaadafc83cc7b382a405d6ba80662e0a4ece3876e4270e3563d859a6ba63b5e3854b39c35873e  system-qbootctl.service
11bb0ff9ab32f0f230c665db2738e37e5226fa200621b9207baf92e0632a38f840395a55ef6e827763911cf78f3bad95cd3456e77cc01b30b8abce96dc13df9d  system-rmtfs.service
1a0958e4fe232967946e9f2b17a13434b137236ba5d18442175d648b084d82df3a9fc5723c1621be899ee290b99777ac3c0ee6ad733e72d8e70f63b37ad00036  system-rtkit-daemon.service
be9df5e3fd9c88ec1a8db4aa2d9e8075d74ee3d2670aa3cfc611df3cff4d4041ac888a0338c9d5f134bbc69aa32eb52ac40eb3e0981813afa18389cba14d3818  system-sleep-inhibitor.service
c569b27925297672c479e12a6425abdf5791886fff77c2c2b67b7aa9277eb0a22e7b95b52dbc225870c97460d0988a4dae18ed864e19096c704c0895de55b699  system-tqftpserv.service
210a7610acfcaee642ac34abe80e77f492e7e2411a9226d26578675893a125b8333a26c2756cf4376745e32fb99a2b7851d737e4df3b2c7d923f730d8ae33e9d  user-wireplumber.service
d55edea6983ad73b1817dfac3e6d418113c8e0fbd6cb2835dedcad2e5c76c8889c09348a184ed4ab38397d7d539831ef6a7ce08037e12c7ab6dc274519dc5812  system-wpa_supplicant.service
9a3620d3df53540a91efa48df322288d96ec887415f538877a979be40eb5239b95917b9ac57fda2c699fe3f1c6500f7de09a4ce6625b0818f5786e125713552f  user-xdg-desktop-portal.service
e09a3c76f3be961dce9f564bb654ea84d1d7fb59907a2168c0569bf6c17a5ebe9fbe4d1f94f1d014433757bb721bc443d5962deb540cacbd5547b1dd47717f92  user-xdg-desktop-portal-rewrite-launchers.service
9dd95f10dcdb6234697b012c6f428cfca0cfbde24a8951e96cb4c463f55a22d40096a94ca0018f9dbe4ebb2c80eb39faeaa9222f6fb419831520a138f88f0321  user-xdg-document-portal.service
1262f10b97989be726432700a923d7717570feb7b0d78c3c573e21ee6be320f5a618d0d21c1eb351702397caa95b476b8854bf83545993fb464b4a7a80067800  user-xdg-permission-store.service
eb01dd32fc598e49cbae31847aee4c3e28ee5014df052d65ad02c9a943a9e3399a4a119aa136630efef1157e31f6adc2d8420f8e72dc9da4c0b72645e4c84faa  user-xdg-desktop-portal-gtk.service
0ee2f844819c5f954d269d3703c17b5e51888bb89bd4376d3960f97735b1ba9769c932817270fdb75b8ddf291c21ab6eb78d1a8bde14aac83564881b36914066  user-xdg-desktop-portal-gnome.service
744c60fdc6e53ba2c9f370ce8462e1a420cfea973edff49d0caf7a3e65f0f35257d61b5ae3ace3e9d9d48e382cb54d9f2ff96ad02d5e16758a49ba2e07963e5a  user-xdg-desktop-portal-wlr.service
"
