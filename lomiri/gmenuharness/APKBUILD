# Maintainer: Luca Weiss <luca@z3ntu.xyz>
pkgname=gmenuharness
pkgver=0_git20230102
_commit="04e27ce98ca2d2b132b9bd0279a80bcb1ccbcc8c"
pkgrel=0
pkgdesc="Library to test GMenuModel structures."
url="https://gitlab.com/ubports/development/core/gmenuharness"
arch="all !armhf"
license="LGPL-3.0-only"
makedepends="
	cmake
	cmake-extras
	glib-dev
	gmock
	gtest-dev
	libqtdbustest
	lomiri-api-dev
	qt5-qtbase-dev
	"
checkdepends="dbus"
source="https://gitlab.com/ubports/development/core/gmenuharness/-/archive/$_commit/gmenuharness-$_commit.tar.gz"
subpackages="$pkgname-dev"
builddir="$srcdir/$pkgname-$_commit"
options="!check" # Tests fail under QEMU

build() {
	cmake -B build \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib
	cmake --build build
}

check() {
	cd build/tests
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
6a2660403a54eef86f716521989fb66dc7bccc08c980c639629d20021e2f848488cfc74349685140659120b8f44fb0a429d2c9bf8f327f17dec66bc6bb815dc0  gmenuharness-04e27ce98ca2d2b132b9bd0279a80bcb1ccbcc8c.tar.gz
"
